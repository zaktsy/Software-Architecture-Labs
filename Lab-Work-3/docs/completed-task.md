## Описание варианта использования
В качестве основного варианта использования для описания был выбран процесс Оформления подписки пользователем. Для упрощения на диаграмме компонентов показаны не все необходимые связи для выполнения запросов, а лишь основные неоходимые для общего понимания принципа работы. Более подпробно все взаимодействия описаны на диаграмме последовательностей.

Код написан так же с упрощением. Реализованы только те методы, которые необходимы для выполнения требуемоего варианта использования.

## Диаграмма компонентов API Пользователя
![API Пользователя diagram](components_1.png "API Пользователя Diagram")


## Диаграмма последовательностей для Оформления подписки

Для оплаты используется API ЮКасса. Для этого при запросе оформления подписки пользователю отправляется ответ-redirect на страницу оплаты. Для получения успешного статуса оплаты с помощью API ЮКасса подписываемся на уведомления. Они реализованы с помощью веб хуков. Когда в систему поступает уведомление о том, что оплата прошла, соотвествующая информация сохраняется В БД.

```mermaid
sequenceDiagram
    participant ВП as Веб-Приложение
    participant SC as Subscription Controller
    participant SR as Subscription Repository
    participant МБ as Маркетинговая БД
    participant PS as Payment Service
    participant ЮК as ЮКасса
    participant UR as User Repository
    participant ОБ as Основная БД

    ВП->>+SC: Оформить подписку

    SC->>+SR: Получить стоимость подписки
    SR ->>+МБ: Получить стоимость подписки
    МБ-->>-SR: Cтоимость подписки
    SR-->>-SC: Cтоимость подписки

    SC ->>+ PS: Запрос на подписку(стоимость подписки)
    PS -) ЮК: Подписаться на уведомления
    PS ->>+ ЮК: Запрос на подписку(платеж)
    ЮК -->>- PS: redirect url для оплаты
    PS -->>- SC: redirect url для оплаты
    SC-->>-ВП: redirect на ЮКасса

    opt Оплата прошла
       ЮК ->> SC: Оплата успешна
       SC ->> UR: Изменить статус подписки
       UR ->> ОБ: Изменить статус подписки
    end
```
